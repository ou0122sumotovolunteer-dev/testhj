<script>
// ----------------------------
// 設定
// ----------------------------
const TARGET_CITY = "洲本市";        // 津波判定
const SHAKE_END_MS = 30 * 60 * 1000; // 地震表示は30分だけ

let lastEarthquakeTime = null;
let earthquakeTimer = null;
let tsunamiActive = false;

// ----------------------------
// 地震情報の取得（P2P地震情報）
// ----------------------------
async function checkEarthquake() {
  try {
    const res = await fetch("https://api.p2pquake.net/v2/history?codes=551&limit=1");
    const data = await res.json();
    if (!data.length) return;

    const eq = data[0].earthquake;
    const time = new Date(eq.time);
    const hypocenter = eq.hypocenter.name;

    // ▼ 震源地域が兵庫県のときだけ表示
    if (!hypocenter.includes("兵庫")) {
      return;
    }

    // 新しい地震なら表示
    if (!lastEarthquakeTime || time > lastEarthquakeTime) {
      lastEarthquakeTime = time;

      const timeStr = time.toLocaleString("ja-JP"); // 時刻を日本語表記で

      showAlertPopup(
        `【地震情報】兵庫県で地震発生\n` +
        `最大震度：${eq.maxScale / 10}\n` +
        `発生時刻：${timeStr}`
      );

      showFooter(`兵庫県で地震発生（最大震度 ${eq.maxScale / 10}）`);

      // 30分後に自動で消す
      if (earthquakeTimer) clearTimeout(earthquakeTimer);
      earthquakeTimer = setTimeout(() => {
        hideAlertPopup();
        if (!tsunamiActive) hideFooter();
      }, SHAKE_END_MS);
    }
  } catch (e) {
    console.log("P2P地震取得エラー", e);
  }
}
</script>
